#!/bin/bash
# Merge mcpServers from chezmoi into existing ~/.claude.json
# This preserves all runtime stats while syncing MCP configuration

set -e

# Read from target file (chezmoi processes templates before running modify scripts)
MCP_CONFIG="$HOME/.claude.json.mcpServers"

# Read current file from stdin
current=$(cat)

if [[ -f "$MCP_CONFIG" ]]; then
    mcp_servers=$(cat "$MCP_CONFIG")
    echo "$current" | jq --argjson mcp "$mcp_servers" '.mcpServers = $mcp'
else
    echo "$current"
fi
