# å±¥æ­´ã¨æ“ä½œæ€§
set -g history-limit 100000

# 256è‰²ãƒ»çœŸã®ã‚«ãƒ©ãƒ¼ï¼ˆiTerm2ç”¨ï¼‰
set -g default-terminal "screen-256color"
set -as terminal-overrides ',xterm-256color:RGB'
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'  # undercurl support
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'  # undercurl colors

# ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—é…å»¶ã‚’ç„¡ãã™ï¼ˆnvimè¡¨ç¤ºå•é¡Œã®ä¸»å› ï¼‰
set -sg escape-time 0

# ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚¤ãƒ™ãƒ³ãƒˆã‚’æœ‰åŠ¹åŒ–
set -g focus-events on

# ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ C-a ã«ï¼ˆå¥½ã¿ã§ï¼‰
set -g prefix C-t
#unbind C-b
#bind C-a send-prefix

# åˆ†å‰²ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼ˆvim é¢¨ï¼‰
bind | split-window -h
bind - split-window -v
unbind '"'
unbind %

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç°¡æ½”åŒ–
set -g status-bg default
set -g status-fg black
set -g status-left '[#S] '
set -g status-right ' #H   %H:%M   %Y-%m-%d '
set -g history-limit 100000

# ãƒã‚¦ã‚¹æœ‰åŠ¹
set -g mouse on

# copy-mode ã®é¸æŠã‚’è‡ªå‹•ã§ pbcopy ã«æµã™
set -s copy-command 'pbcopy'
set -g set-clipboard on          # tmuxå´ã§ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰é€£æºã‚’è¨±å¯

# vi ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰å‰æï¼ˆå¥½ã¿ï¼‰
#setw -g mode-keys vi

# ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§ã®ã‚³ãƒ”ãƒ¼: 'y' ã§é¸æŠç¯„å›²ã‚’ pbcopy
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# ãƒã‚¦ã‚¹ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†æ™‚ã«ã‚‚ pbcopy
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# ãƒšã‚¤ãƒ³ã®é–‹å§‹ç•ªå·ã‚’ 0 ã‹ã‚‰ 1 ã«å¤‰æ›´ã™ã‚‹
set-option -g base-index 1

# tmuxã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ã‚¹ã‚’å¤‰æ›´
unbind c
bind c new-window -c "#{pane_current_path}"

# æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆç›´å¾Œ
set-hook -g after-new-session 'run-shell "printf \"\033]0;%s\007\" \"#{socket_path:t}\""'

# ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒ attach ã—ãŸç›´å¾Œï¼ˆæ¨å¥¨ï¼‰
set-hook -g client-attached 'run-shell "printf \"\033]0;%s\007\" \"#{socket_path:t}\""'

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã®åŸºæœ¬é•·ã•
set -g status-left-length 40
set -g status-right-length 80

# ================================
#  Session-specific color themes + icons
# ================================
run-shell "
case '#S' in \
  salon-dev)
    tmux set -s status-bg colour33;   # blue
    tmux set -s status-fg black
    tmux set -s status-left ' ğŸ’‡  #S #[fg=colour33,bg=default]'
    ;; \
  base)
    tmux set -s status-bg colour34;   # green
    tmux set -s status-fg black
    tmux set -s status-left ' ğŸ§±  #S #[fg=colour34,bg=default]'
    ;; \
  core-dev)
    tmux set -s status-bg colour166;  # orange
    tmux set -s status-fg black
    tmux set -s status-left ' âš™ï¸  #S #[fg=colour166,bg=default]'
    ;; \
  app-dev)
    tmux set -s status-bg colour205;  # pink-ish red
    tmux set -s status-fg black
    tmux set -s status-left ' ğŸ“±  #S #[fg=colour205,bg=default]'
    ;; \
  exp-dev)
    tmux set -s status-bg colour127;  # purple
    tmux set -s status-fg black
    tmux set -s status-left ' ğŸ§ª  #S #[fg=colour127,bg=default]'
    ;; \
  ops-dev)
    tmux set -s status-bg colour226;  # yellow
    tmux set -s status-fg black
    tmux set -s status-left ' ğŸ“Š  #S #[fg=colour226,bg=default]'
    ;; \
  ai-dev)
    tmux set -s status-bg colour45;   # cyan
    tmux set -s status-fg black
    tmux set -s status-left ' ğŸ¤–  #S #[fg=colour45,bg=default]'
    ;; \
  aws)
    tmux set -s status-bg colour208;  # orange (AWS brand)
    tmux set -s status-fg black
    tmux set -s status-left ' â˜ï¸  #S #[fg=colour208,bg=default]'
    ;; \
  infra)
    tmux set -s status-bg colour240;  # gray
    tmux set -s status-fg white
    tmux set -s status-left ' ğŸ—ï¸  #S #[fg=colour240,bg=default]'
    ;; \
  obsidian)
    tmux set -s status-bg colour93;   # purple (Obsidian brand)
    tmux set -s status-fg white
    tmux set -s status-left ' ğŸ“  #S #[fg=colour93,bg=default]'
    ;; \
  *)
    # æœªå®šç¾©ã‚»ãƒƒã‚·ãƒ§ãƒ³: ã‚»ãƒƒã‚·ãƒ§ãƒ³åã®ãƒãƒƒã‚·ãƒ¥ã‹ã‚‰ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆã‚’é¸æŠ
    hash_val=\$(printf '%s' '#S' | md5 -q | cut -c1-2)
    color_idx=\$((16#\$hash_val % 12))
    colors=(33 34 166 205 127 226 45 208 93 214 81 39)
    bg_color=\${colors[\$color_idx]}
    tmux set -s status-bg colour\$bg_color
    tmux set -s status-fg black
    tmux set -s status-left ' ğŸ“Œ  #S #[fg=colour'\$bg_color',bg=default]'
    ;; \
esac
"
# ã‚»ãƒƒã‚·ãƒ§ãƒ³åãŒå¤‰ã‚ã£ãŸã‚‰è‡ªå‹•ã§è¨­å®šå†èª­è¾¼
set-hook -g session-renamed 'run-shell "tmux source-file ~/.tmux.conf"'
# æ–°ã—ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆæ™‚ã«ã‚‚é©ç”¨
set-hook -g after-new-session 'run-shell "tmux source-file ~/.tmux.conf"'

##### TPM #####
set -g @plugin 'tmux-plugins/tpm'

##### Session restore #####
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

##### Session management #####
set -g @plugin 'tmux-plugins/tmux-sessionist'

# èµ·å‹•æ™‚ã«è‡ªå‹•å¾©å…ƒ
set -g @continuum-restore 'on'

# è‡ªå‹•ä¿å­˜é–“éš”ï¼ˆåˆ†ï¼‰
set -g @continuum-save-interval '15'

# å¾©å…ƒã™ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚’åˆ¶é™ï¼ˆå®‰å…¨å¯„ã‚Šï¼‰
set -g @resurrect-processes 'ssh zsh bash fish vim nvim git'

##### Keybinds #####
# ä¿å­˜: prefix + Ctrl-s
# å¾©å…ƒ: prefix + Ctrl-r

##### TPM initï¼ˆå¿…ãšä¸€ç•ªä¸‹ï¼‰ #####
run '~/.tmux/plugins/tpm/tpm'
